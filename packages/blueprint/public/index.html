<!DOCTYPE html>
<html>
  <head>
    <title>index</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="matrix-code.js"></script>
    <script src="dm-data-source.js" type="module"></script>
    <script src="dm-console.js" type="module"></script>
    <script src="dm-data-table.js" type="module"></script>
    <style>
      :root {
        background-color: #000;
        color: #eee;
      }
    </style>
  </head>
  <body style="height: 100vh; margin: 0; padding: 8px; box-sizing: border-box">
    <div style="display: flex; flex-direction: column; height: 100%">
      <dm-data-source id="ds" src="/todos" live></dm-data-source>
      <aside onchange="tabChange()">
        <label><input type="radio" name="tab" value="dm-console" checked />console</label>
        <label><input type="radio" name="tab" value="dm-data-table" />table</label>
      </aside>
      <main id="main" style="flex: 1 1">
        <dm-console>
          <div slot="input" style="display: flex">
            <dm-send style="flex: 1 1"></dm-send>
            <button onclick="startCamera()">start camera</button>
            <button onclick="stopCamera()">stop camera</button>
            <script>
              function startCamera() {
                fetch('/', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    type: 'start',
                    camera: 'labo1',
                    url: 'rtmp://a.rtmp.youtube.com/live2/8bgh-fhbb-dt08-cf9b-3hyd',
                  }),
                })
              }
              function stopCamera() {
                fetch('/', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ type: 'stop', camera: 'labo1' }),
                })
              }
            </script>
            <dm-upload-receipt-button></dm-upload-receipt-button>
          </div>
        </dm-console>
      </main>
    </div>
    <dm-matrix-code
      src="/"
      style="position: fixed; top: 0; left: 0; bottom: 0; right: 0; z-index: -999"
    ></dm-matrix-code>

    <script>
      async function tabChange() {
        const tabs = document.getElementsByName('tab')
        const tab = Array.from(tabs).find((v) => v.checked)

        const main = document.getElementById('main')
        main.innerHTML = ''
        const ds = document.getElementById('ds')
        const view = document.createElement(tab.value)
        view.source = ds
        main.append(view)
      }
    </script>
  </body>
</html>
