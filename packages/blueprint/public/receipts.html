<!DOCTYPE html>
<html>
  <head>
    <title>Input Receipt</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="upload-receipt-button.js"></script>
    <style>
      :root {
        background-color: #000;
        color: #eee;
      }
    </style>
  </head>
  <body>
    <div>
      <button onclick="load()">refresh</button>
      <script>
        async function load() {
          const thumbnails = document.getElementById('thumbnails')
          thumbnails.innerHTML = ''
          const res = await fetch('/receipts')
          const data = await res.json()
          for (const item of data) {
            const span = document.createElement('span')
            span.textContent = JSON.stringify(item)
            thumbnails.append(span)
            // const thumbnail = document.createElement('dm-thumbnail')
            // thumbnail.setAttribute('src', `/receipts/${item.id}`)
            // thumbnail.setAttribute('data-text', JSON.stringify(item))
            // thumbnails.append(thumbnail)
          }
        }
        onload = () => load()
      </script>
      <dm-upload-receipt-button></dm-upload-receipt-button>
    </div>

    <div id="thumbnails" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px"></div>
    <script>
      customElements.define(
        'dm-thumbnail',
        class extends HTMLElement {
          root
          text
          img
          constructor() {
            super()
            const root = this.attachShadow({ mode: 'open' })
            const text = document.createElement('span')
            const img = document.createElement('img')
            root.append(text)
            root.append(img)
            this.text = text
            this.img = img
            this.root = root
          }

          connectedCallback() {
            if (!this.isConnected) return
            this.img.src = this.getAttribute('src')
            this.text.textContent = this.getAttribute('data-text')
            this.root.append(tmpl.content.cloneNode(true))
          }
        }
      )
    </script>

    <template id="tmpl">
      <style>
        :host {
          position: relative;
        }
        span {
          position: absolute;
          background-color: '#0005';
          color: '#fff';
          white-space: 'break-all';
          bottom: 0;
        }
        img {
          width: 100%;
        }
      </style>
    </template>
  </body>
</html>
