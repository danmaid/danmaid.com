<!DOCTYPE html>
<html>
  <head>
    <title>Console</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="console.js"></script>
    <style>
      :root {
        background-color: #000;
        color: #eee;
      }
    </style>
  </head>
  <body style="height: 100vh; margin: 0; padding: 8px; box-sizing: border-box">
    <dm-console id="console" style="height: 100%"></dm-console>

    <div style="position: absolute; top: 0; right: 0">
      <button onclick="start()">start</button>
      <button onclick="stop()">stop</button>
      <button onclick="console.clear()">clear</button>
    </div>

    <script>
      class EventSourceStub extends EventTarget {
        constructor() {
          super()
          this.addEventListener('message', (...args) => this.onmessage(...args))
        }
        onmessage() {}
        emit(data) {
          const event = new MessageEvent('message', { data: JSON.stringify(data) })
          return this.dispatchEvent(event)
        }
      }

      const stub = new EventSourceStub()

      const console = document.getElementById('console')
      console.src = stub

      let timer
      function start() {
        stop()
        timer = setInterval(() => stub.emit({ date: new Date() }), 500)
      }
      function stop() {
        clearInterval(timer)
      }
    </script>
  </body>
</html>
