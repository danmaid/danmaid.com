<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>components demo</title>
  </head>
  <body>
    <div id="app"></div>
    <!-- <script type="module" src="/src/aws.ts"></script> -->
    <button id="get">get</button>
    <script type="module">
      import { AWSV4Signature } from '/src/AWSV4Signature.ts'
      document.getElementById('get').onclick = async () => {
        const key = 'AKIARKIDCK2G4KGREPBI'
        const secret = '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'

        const v4Signature = new AWSV4Signature({ key, secret })

        const headers = new Headers({
          'X-Amz-Target': 'Logs_20140328.FilterLogEvents',
          'X-Amz-Date': new Date().toISOString().replace(/\.\d{3}|[-:]/g, ''),
          'Content-Type': 'application/x-amz-json-1.1',
        })
        const body = JSON.stringify({
          logGroupIdentifier: `arn:aws:logs:us-east-1:090737628813:log-group:/aws/route53/danmaid.com`,
          limit: 10,
          startTime: new Date().getTime() - 60 * 60 * 1000,
        })
        const req = new Request('https://logs.us-east-1.amazonaws.com', { headers, body, method: 'POST' })
        await v4Signature.sign(req)
        console.log(req)
        const res = await fetch(req)
        const data = await res.json()
        document.getElementById('app').innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`
      }
    </script>
  </body>
</html>
